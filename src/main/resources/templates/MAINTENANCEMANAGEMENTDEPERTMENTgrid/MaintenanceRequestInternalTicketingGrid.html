<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maintenance Request Form (Internal Ticketing)</title>
    
    <link rel="stylesheet" href="/css/hrms.css"> <!-- // for side bar code  -->
    <link rel="stylesheet" href="/css/grid.css">
    <link rel="stylesheet" href="/css/emplist.css">

    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
<div th:replace="~{MAINTENANCEMANAGEMENTDEPERTMENT.html :: sidebarFragment}"></div> <!-- // for side bar code  -->

<div class="button-container">
    
</div>

<div class="button-grid">
    <button onclick="loadmaintenancerequestinternalticketingTable()"style="width:112%">Maintenance Request Form (Internal Ticketing) </button>
</div>

<div id="maintenancerequestinternalticketing-table-container">
   
</div> <!-- Table will be dynamically loaded here -->

<script src="/js/grid.js"></script>

<script>
    function loadmaintenancerequestinternalticketingTable() {
        // Create the button and table container structure immediately
        const container = document.getElementById("maintenancerequestinternalticketing-table-container");
        container.innerHTML =`
            <div class="table-header">
				<div class="button-container" style="margin-left: 1045px;">
				                <button class="styled-button" onclick="window.location.href='/maintenancemanagementdepartment/maintenancerequestinternalticketinggrid'" style="flex-grow: 1;">
				                    <i class="fas fa-arrow-left"></i> Back
				                </button>
				                <button id="open-register-btn" class="styled-button" style="flex-grow: 1; margin-left: 20px;">
				                Maintenance Request Form (Internal Ticketing)
				                </button>
				            </div>
				</div>
            <table>
                <thead>
                    <tr>
                    <th>Id</th>
    				<th>Maintenance Request Form (Internal Ticketing) UID</th>
    				<th>Equipment Master UID</th>
    				<th>Equipment Name</th>
    				<th>Employee UID</th>
    				<th>Employee Name</th>
    				<th>Department Name</th>
    				<th>Priority Level </th>
    				<th>Request Date</th>	
    				<th>Status</th>
    				<th>Issue Description</th>
                    <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="maintenancerequestinternalticketingmanagement-table-body">
                    <tr><td colspan="9">Loading data...</td></tr>
                </tbody>
            </table>
        `;

        // Add event listener to the "Maintenance Request Form (Internal Ticketing) Form" button
        document.getElementById("open-register-btn").addEventListener("click", () => {
            // Redirect to the Maintenance Request Form (Internal Ticketing) Form 
            window.location.href = '/maintenancerequestinternalticketingform';
        });

        // Fetch and populate table data
        fetch('/viewmaintenancerequestinternalticketing')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            
            .then(data => {
                const headers = data.headers; // Extract headers dynamically
                const rows = data.data;      // Extract Maintenance Request Form (Internal Ticketing) Form data
                const tbody = document.getElementById("maintenancerequestinternalticketingmanagement-table-body");

                // Check if there are rows to display
                if (rows.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="9">No data available.</td></tr>`;
                    return;
                }

                // Generate rows from data
                tbody.innerHTML = rows.map(row => `
                    <tr>
                        <td>${row['ID']}</td>
                        <td>${row['Maintenance Request Internal Ticketing UID']}</td>
                        <td>${row['Equipment Master UID']}</td>
                        <td>${row['Equipment Name']}</td>
                        <td>${row['Employee UID']}</td>
                        <td>${row['Employee Name']}</td>
                        <td>${row['Department Name']}</td>
                        <td>${row['Priority Level']}</td>
                        <td>${row['Request Date']}</td>
                        <td>${row['Status']}</td>
                        <td>${row['Issue Description']}</td>
                        <td>
                            <div class="action-buttons">
                                <a href="#" class="btn btn-delete" data-id="${row['ID']}" onclick="confirmDeleteMaintenanceHistoryLog(this)">Delete</a>
                                <a href="/updatemaintenancerequestinternalticketing/${row['ID']}" class="btn btn-update">Update</a>
                            </div>
                        </td>
                    </tr>
                `).join('');
            })
            .catch(error => {
                console.error('Error fetching Maintenance Request Form (Internal Ticketing) data:', error);
                document.getElementById("maintenancerequestinternalticketingmanagement-table-body").innerHTML = `<tr><td colspan="9">Error loading data.</td></tr>`;
            });
    }

    // Example function to handle delete action
    	function confirmDeleteMaintenanceHistoryLog(element) {
	    const id = element.getAttribute('data-id'); // Retrieve the Maintenance Request Form (Internal Ticketing) Form  ID
	    if (confirm(`Are you sure you want to delete Maintenance Request Form (Internal Ticketing) with ID: ${id}?`)) {
	        // Perform the fetch request with the Maintenance Request Form (Internal Ticketing) ID as a query parameter
	        fetch(`/maintenancerequestinternalticketingdeleteinfo?id=${id}`, { method: 'GET' })
	            .then(response => {
	                if (response.redirected) {
	                    // Redirect to the new location if the server redirects
	                    loadmaintenancerequestinternalticketingTable();
	                    window.location.href = response.url;
	                } else {
	                    console.log('Maintenance Request Form (Internal Ticketing) Form data deleted:', id);
	                }
	            })
	            .catch(error => {
	                console.error('Error deleting Maintenance Request Form (Internal Ticketing) Form data:', error);
	            });
	    }
	}
	
	
</script>




</body>
</html>
